!function(a){function b(b,c){this.$modal=a("#"+a(b).attr("href").replace("#",""));var d=f(this.$modal.data("mimo"));this.options=a.extend({},e,d,c),this.options.close="."+this.options.close.replace(/["'\.]/g,""),this.element=b,this.init()}var c="minimodal",d="plugin_"+c,e={opacity:.3,top:100,width:450,selector:".mimo_open",close:".mimo_close",modal:".mimo_modal",background:"#mimo_bg"},f=function(b){if("string"==typeof b){for(var c=b.split(";"),d={},e=0;e<c.length;e++){var f=c[e],g=f.split(":");g&&(g[0]=a.trim(g[0]),g[1]=a.trim(g[1]),""!==g[0]&&""!==g[1]&&(d[g[0]]=g[1]))}return d}};a.extend(b.prototype,{init:function(){var b=this;this.onClick=function(c){b.openModal(),a(b.options.close+", "+b.options.background).on("click",b.onClickClose),c.preventDefault()},this.onClickClose=function(c){b.closeModal(),a(b.options.close+", "+b.options.background).off("click",b.onClickClose),c.preventDefault()},a(this.element).on("click",this.onClick),$closeButton=this.$modal.find(this.options.close),$closeButton.length||(a("<div class="+e.close.replace(/\./,"")+">&#x2716;</div>").prependTo(this.$modal),this.options.close=e.close)},destroy:function(){a(this.element).off("click",this.onClick)},openModal:function(){a(this.options.background).length||a("body").append(a("<div></div>").attr("id",this.options.background.replace(/#/g,""))),a(this.options.background).fadeTo(250,this.options.opacity),this.$modal.css({maxWidth:this.options.width}).fadeTo(250,1),this.centerModal()},closeModal:function(){a(this.options.background+", "+this.options.modal).hide()},centerModal:function(){var b,c,d=this.$modal.outerWidth(!0),e=this.$modal.outerHeight(!0),f=a(window).width(),g=a(window).height();console.log(d,f),d=f>this.options.width?this.options.width:f,b=(f-d)/2,c=(g-e)/2,b=0>b?0:b,c=0>c?0:c>this.options.top?c=this.options.top:c,c+=a(window).scrollTop(),this.$modal.css({left:b,top:c})}}),a.fn[c]=function(c){return this.each(function(){a.data(this,d)&&a.data(this,d).destroy(),a.data(this,d,new b(this,c))})},a(window).on("resize",function(){console.log("fires"),setTimeout(function(){a(e.selector).each(function(){a.data(this,d).centerModal()})},0)}),a(document).on("keydown",function(b){27===b.keyCode&&a(e.selector).each(function(){a.data(this,d).closeModal()})}),a(e.selector).each(function(){a(this).minimodal()})}(jQuery);